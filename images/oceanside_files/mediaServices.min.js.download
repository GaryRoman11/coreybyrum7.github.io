define("mediaServices",["lodash","constants","util","stateManagement","media-manager-api","image-client-api","coreBi"],function(A,e,P,I,a,u,t){"use strict";var w=t.events.singleVideoPlayer,i=P.backgroundUtils,F=i.getMediaPlayerVideoObject,L=i.getChangeVideoBiEventFields,R=i.getStoryboardDisplayValue,k=I.editorPlugins.userPreferences.actions.setSessionUserPreferences,r=I.editorPlugins.userPreferences.selectors.getSessionUserPreferences,m=I.editorPlugins.userPreferences.selectors.getMediaPath,o=e.CLIPART_DATA_KEYS,n=e.VECTOR_IMAGE_DEFAULTS,g=n.VECTOR_IMAGE_CATEGORY,p=n.VECTOR_SHAPE_DEFAULT_PATH,h=n.VECTOR_ART_DEFAULT_PATH,f="change_basic_shape";function s(e){var a=e.split("/");return 2===a.length?parseFloat(a[0])/parseFloat(a[1]):parseFloat(a[0])}function c(e){return 50<s(e)}function l(e){return e&&c(e)?30/s(e):1}return{create:function(E){function C(){var e=window.document.querySelector("#editor");if(e){var a=window.document,t=a.documentElement.scrollTop||a.body.scrollTop;e.focus(),a.documentElement.scrollTop=a.body.scrollTop=t}}return{initMediaManager:function(e){E.mediaServices.mediaManager=a.create(A.assign(e,{origin:a.origins.EDITOR}))},mediaManager:null,hasSlowMo:c,getPlaybackSpeedByFPS:l,setFocusToEditor:C,changeWPhoto:function(l){var d=P.imageTransform.fittingTypes,g=E.components.data.get(l),e=E.store,p=e.dispatch,a=(0,e.getState)(),t=m(g.uri)(a);E.mediaServices.mediaManager.open(E.mediaServices.mediaManager.categories.IMAGE,"change_image",{translation:{title:P.translate("Image_Media_Choose_Image"),submitButton:P.translate("MMGR_submitbutton_onstage_image_uploads_choose")},path:t,multiSelect:!1,callback:function(e,a){if(e){var t=A.head(e),i=E.components.layout.get(l),n=E.components.properties.get(l).displayMode,o=t.width,r=t.height,s={width:o,height:r,uri:t.fileName,name:t.title,alt:t.title,crop:null,focalPoint:null,originalImageDataRef:null};if(g.crop&&E.imageCrop.isCropAllowed(s.uri)&&!P.url.isExternalUrl(s.uri)){var c=function(e,a,t,i,n){if(n!==u.fittingTypes.SCALE_TO_FILL&&n!==u.fittingTypes.LEGACY_FULL)return null;var o=Math.min(t/e,i/a),r=e*o,s=a*o;return{width:Math.round(r),height:Math.round(s),x:Math.round((t-r)/2),y:Math.round((i-s)/2)}}(i.width,i.height,o,r,n);s.crop=A.assign({},g.crop,c)}p(k("last_media_path_"+s.uri,a.path)),E.components.data.update(l,s,!0),n===P.imageTransform.fittingTypes.LEGACY_FULL&&E.components.properties.update(l,{displayMode:d.SCALE_TO_FILL},!0),E.history.add("Change Image"),C()}}})},changeVectorImage:function(n,e,a,o){var t=E.store.getState(),r=E.components.data.get(n),i=A.get(r,["svgId"]),s=E.media.vectorImage.getSvgInfoFromCache(i).svgType,c="shape"===s?p:h,l="shape"===s?f:"change_vector_art",d=m(i)(t)||a||c;E.mediaServices.mediaManager.open(E.mediaServices.mediaManager.categories[e||g],l,{multiSelect:!1,callback:function(e,a){if(!A.isEmpty(e)){var t=A.get(e,[0,"title"],""),i=A.get(e,[0,"uri"]);P.vectorImageUtils.replaceVectorImage(E,n,r,t,i,o),E.store.dispatch(k("last_media_path_"+i,a.path||"")),C()}},path:d})},changeClipArt:function(i,e){var a=E.components.data.get(i),t=E.store.getState(),n=m(a.uri)(t);E.mediaServices.mediaManager.open(e,{multiSelect:!1,translation:{submitButton:P.translate("MMGR_submitbutton_onstage_clipart_freeclipart_choose")},path:n,callback:function(e,a){if(e){var t=A.pick(e[0],o);t.uri=e[0].fileName,t.originalImageDataRef=null,t.crop=null,E.store.dispatch(k("last_media_path_"+t.uri,a.path)),E.components.data.update(i,t,!0),E.history.add("Change Clipart"),C()}}})},changeVideo:function(y){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:E.mediaServices.mediaManager.categories.VIDEO,a=E.store,S=a.dispatch,t=a.getState,b=E.components.design.get(y),M=E.components.properties.get(y),T=E.components.layout.get(y),i=A.get(b.background,["mediaRef","videoId"],""),n=A.get(b.background,["mediaRef","mediaFeatures"],[]),o=r("last_media_path_"+i)(t());!o&&A.includes(n,"alpha")&&(o="public/5d54b10e-e5e3-416b-9a2f-9316773f2a5b/078ecd58-f828-44f6-ac91-8cafbf5dbdae"),E.mediaServices.mediaManager.open(e,"change_video_box",{multiSelect:!1,callback:function(e,a){if(e){var t=A.head(e),i=F(t,a);if(A.includes(i.mediaFeatures,"alpha")){var n=A.maxBy(i.qualities,"width")||{},o=n.width/n.height,r=E.dsRead.components.layout.getLimits(A.isArray(y)?y[0]:y),s=A.assign({},r,T),c=P.layoutUtils.getLayoutWithAspectRatio(s,o,null);E.components.layout.update(y,c,!0)}var l,d,g,p,u=(l=b,d=i.mediaFeatures,g=A.includes(d,"alpha"),p=A.cloneDeep(l),g?(p.cssStyle={cssBorder:null,cssBorderRadius:null,cssBoxShadow:null},p.background.imageOverlay=null,p.background.colorOverlay=""):p.background.filterEffect=null,p);u.background.mediaRef=i,E.components.design.update(y,u,!0);var m={};A.get(M,"autoplay")&&A.assign(m,{autoplay:!0,mute:!0}),E.components.properties.update(y,m);var h=E.components.getChildren(y),f=A.find(h,function(e){return"wysiwyg.viewer.components.MediaControls"===E.components.getType(e)}),_=E.components.properties.get(f),v=A.get(_,"showStoryboard");_.showStoryboard=R(i,v),E.components.properties.update(f,_,!0),E.history.add("Change Video"),E.store.dispatch(I.editorPlugins.bi.actions.event(w.video_player_video_changed,L(e[0],"video_player_gfpp"))),S(k("last_media_path_"+i.videoId,a.path||"")),C()}},path:o})},changeShape:function(i){var e=E.mediaServices;e.mediaManager.open(e.mediaManager.categories.SHAPE,f,{multiSelect:!1,callback:function(e){if(!A.isEmpty(e)){var a=P.svgUrlParser.parseSvgSkinFromUrl(e[0].fileUrl),t=E.components.style.get(i);a!==t.skin&&(t.skin=a,E.components.style.update(i,t),E.history.add("Change Shape"),C())}},translation:{submitButton:P.translate("Shape_Media_Change_Shape")}})}}}}});
//# sourceMappingURL=mediaServices.min.js.map